<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        

        const PENDING = 'pending';
        const FULFILLED = 'fulfilled';
        const REJECTED = 'rejected';
        class MyPromise{
            #promiseState = PENDING;
            #promiseResult = null;
            constructor(executor) {
                try {
                    executor(this.resolve.bind(this), this.reject.bind(this));
                } catch(err) {
                    this.reject(err);
                }
            }
            changeState(state, result) {
                if (this.#promiseState !== PENDING) return;
                this.#promiseState = state;
                this.#promiseResult = result;
            }
            resolve(res) {
                this.changeState(FULFILLED, res);
            }
            reject(err) {
                this.changeState(REJECTED, err);
            }
            // 成功状态触发成功回调，失败状态触发失败回调。
            then(onFulfilled, onRejected) {
                // console.log("🚀 ~ MyPromise ~ then ~ onRejected:", onRejected)
                // console.log("🚀 ~ MyPromise ~ then ~ onFulfilled:", onFulfilled)
                return new Promise((resolve, reject) => {
                    if (this.#promiseState === FULFILLED) {
                        const data = onFulfilled(this.#promiseResult)
                        resolve(data);
                    } else if (this.#promiseState === REJECTED) {
                        const data = onRejected(this.#promiseResult)
                        resolve(data);
                    } else {
                        // 需要一段时间，才有结果
                    }
                })
            }
        }
        const p = new MyPromise((resolve, reject) => {
            resolve(999)
            // throw new Error('错误');
            // resolve(1212);
            // setTimeout(() => {
            //     resolve(11);
            // }, 1000)
        })
        p.then(res => {
            res += 100999222;
            return res;
        })  // 假设 res=999，这里返回 1007（但被丢弃）
        .then(res => console.log(res)) // 输出 undefined 而非 1007
    </script>
</body>
</html>